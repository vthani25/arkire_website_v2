---
import fs from 'fs';
import path from 'path';
import { marked } from 'marked';

const { slug } = Astro.params;
const postPath = path.resolve(`./src/pages/blog/${slug}.md`);

let content = '';
try {
  content = fs.readFileSync(postPath, 'utf-8');
} catch {
  throw new Error(`404: Post not found`);
}

const frontmatterRegex = /^---\n([\s\S]+?)\n---/;
const match = content.match(frontmatterRegex);

let frontmatter = {};
let markdown = content;

if (match) {
  const fmText = match[1];
  markdown = content.slice(match[0].length);
  frontmatter = Object.fromEntries(
    fmText.split('\n').map(line => {
      const [key, ...rest] = line.split(':');
      return [key.trim(), rest.join(':').trim()];
    })
  );
}
const html = marked.parse(markdown);
---

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arkire</title>
    <link rel="icon" href="/assets/mascot_main.png" type="image/png">
  </head>
  <body style="font-family: sans-serif; background: #fffdfb; padding: 2rem;">
    <main class="container">
      <h1>{frontmatter.title}</h1>
      <p><em>{frontmatter.date}</em></p>
      
      <article set:html={html} class="markdown"></article>
      <a href="/blog">â† Back to Blog</a>
    </main>

  </body>
</html>
